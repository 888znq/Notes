<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Infinity Notes</title>
    
    <link rel="manifest" href="manifest.json">

    <meta name="theme-color" content="#0A0B10">
    <meta name="mobile-web-app-capable" content="yes">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Infinity Notes">
    <link href="https://fonts.googleapis.com/css2?family=Lexend+Deca:wght@300;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --row-height: 100px; 
            --num-width: 70px; 
            --font-main: 1.8rem;
            --line-weight: 2px; /* Uniform line width for everything */
            --bg-dark: #0A0B10; /* Deep Midnight */
            --accent: #00F2FF;  /* Terminal Cyan */
            --accent-dim: rgba(0, 242, 255, 0.15);
            --line-style: var(--line-weight) solid var(--accent);
            --deck-height: 240px; 
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--bg-dark);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            font-family: 'Lexend Deca', sans-serif;
            overflow: hidden;
            overscroll-behavior-y: none; 
            user-select: none; 
        }

        .app-frame {
            display: flex;
            flex-direction: column;
            height: calc(100vh - var(--deck-height));
            width: 100%;
            border-left: var(--line-style);
            border-right: var(--line-style);
            position: relative;
            counter-reset: note-counter;
        }

        #notes-list {
            display: flex;
            flex-direction: column; 
            justify-content: flex-end; 
            width: 100%;
            overflow-y: auto;
            flex-grow: 1;
            -webkit-mask-image: linear-gradient(to top, black 90%, transparent 100%);
            mask-image: linear-gradient(to top, black 90%, transparent 100%);
        }

        .grid-row {
            display: grid;
            grid-template-columns: var(--num-width) 1fr;
            width: 100%;
            height: var(--row-height);
            flex-shrink: 0;
            background-color: var(--bg-dark);
            border-top: var(--line-style); /* All lines are identical */
        }

        .grid-row.hidden { display: none !important; }

        .spacer-line {
            height: 100%;
            background-color: var(--bg-dark);
            border-right: var(--line-style); /* Uniform lines */
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            color: var(--accent);
            font-weight: 900;
        }

        .spacer-line.infinity::after { 
            content: "∞"; 
            font-size: 2rem;
            color: var(--accent);
        }

        .spacer-line.number::before {
            counter-increment: note-counter;
            content: counter(note-counter);
            font-size: 1.1rem;
            color: var(--accent);
            opacity: 0.7;
        }

        .content-wrapper {
            position: relative;
            overflow: hidden;
            background-color: var(--accent);
            height: 100%;
            display: flex; 
        }

        .note-content {
            width: 100%;
            height: 100%;
            background-color: var(--bg-dark);
            color: var(--accent);
            border: none;
            padding: 15px 20px 0 20px; 
            font-size: var(--font-main);
            font-weight: 900;
            outline: none;
            display: flex;
            align-items: center;
            caret-color: var(--accent);
            white-space: nowrap;
            overflow: hidden;
            transition: transform 0.25s cubic-bezier(0.2, 0, 0.2, 1);
            position: relative;
            z-index: 2;
            user-select: text; 
        }

        /* --- INPUT STYLES --- */
        #cat-input {
            width: 90px;
            height: 100%;
            background-color: var(--bg-dark);
            color: var(--accent);
            border: none;
            border-right: var(--line-style);
            font-family: 'Lexend Deca', sans-serif;
            font-size: 0.85rem;
            font-weight: 900;
            text-transform: uppercase;
            text-align: center;
            padding: 0 5px;
            outline: none;
            z-index: 5;
            user-select: text;
        }
        #cat-input::placeholder { color: var(--accent-dim); }

        .note-cat-label {
            position: absolute;
            top: 10px;
            left: 20px;
            font-size: 0.6rem;
            text-transform: uppercase;
            color: var(--accent);
            opacity: 0.5;
            letter-spacing: 2px;
            pointer-events: none;
            z-index: 3;
        }

        /* --- CATEGORY DECK --- */
        #category-deck {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: var(--deck-height);
            background-color: var(--bg-dark);
            border-top: var(--line-style); /* Frame consistency */
            border-left: var(--line-style);
            border-right: var(--line-style);
            z-index: 100;
            display: flex;
            flex-direction: column;
            padding: 20px;
        }

        .deck-label {
            font-size: 0.65rem;
            color: var(--accent);
            text-transform: uppercase;
            margin-bottom: 15px;
            opacity: 0.6;
            text-align: center;
            letter-spacing: 4px;
        }

        #deck-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            overflow-y: auto;
            justify-content: center;
            align-content: flex-start;
            height: 100%;
            padding-bottom: 20px;
        }

        .deck-btn {
            background-color: transparent;
            border: var(--line-weight) solid var(--accent);
            color: var(--accent);
            font-family: 'Lexend Deca', sans-serif;
            font-weight: 900;
            font-size: 0.85rem;
            text-transform: uppercase;
            padding: 14px 18px;
            cursor: pointer;
            flex-grow: 1;
            min-width: 100px;
            max-width: 46%;
            text-align: center;
            transition: all 0.2s;
            letter-spacing: 1px;
        }

        .deck-btn:active { transform: scale(0.96); }

        .deck-btn.active {
            background-color: var(--accent);
            color: var(--bg-dark);
            box-shadow: 0 0 20px var(--accent-dim);
        }

        /* --- UTILITY --- */
        .delete-hint {
            position: absolute;
            right: 25px;
            top: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            color: var(--bg-dark);
            font-size: 0.9rem;
            font-weight: 900;
            z-index: 1;
        }

        .desktop-delete-btn {
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 70px;
            background-color: var(--bg-dark);
            color: var(--accent);
            border: none;
            font-family: 'Lexend Deca', sans-serif;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
            opacity: 0; 
            transition: opacity 0.2s;
        }

        .content-wrapper:hover .desktop-delete-btn { opacity: 1; }
        .desktop-delete-btn:hover { background-color: var(--accent); color: var(--bg-dark); }
        
        @media (hover: none) {
            .desktop-delete-btn { display: none; }
        }

        #notes-list::-webkit-scrollbar { display: none; }
        #deck-grid::-webkit-scrollbar { display: none; }
        #main-input { padding-top: 0; font-size: 1.9rem; } 
    </style>
</head>
<body>

    <div class="app-frame">
        <div id="notes-list"></div>

        <div class="input-area grid-row">
            <div class="spacer-line infinity"></div>
            <div class="content-wrapper">
                <input id="cat-input" list="cat-suggestions" placeholder="CAT" autocomplete="off">
                <datalist id="cat-suggestions"></datalist>
                <div id="main-input" class="note-content" contenteditable="true" spellcheck="false"></div>
            </div>
        </div>
    </div>

    <div id="category-deck">
        <div class="deck-label">SYSTEM_CATEGORIES (HOLD_TO_WIPE)</div>
        <div id="deck-grid"></div>
    </div>

<script>
    // NO LOGIC CHANGES MADE BELOW
    const notesList = document.getElementById('notes-list');
    const mainInput = document.getElementById('main-input');
    const catInput = document.getElementById('cat-input');
    const catDataList = document.getElementById('cat-suggestions');
    const deckGrid = document.getElementById('deck-grid');

    let savedCategories = new Set();
    let currentFilter = ''; 

    function renderDeck() {
        deckGrid.innerHTML = '';
        savedCategories.forEach(cat => {
            const btn = document.createElement('button');
            btn.className = `deck-btn ${currentFilter === cat ? 'active' : ''}`;
            btn.innerText = cat;
            
            let pressTimer;
            let isLongPress = false;

            const startPress = () => {
                isLongPress = false;
                pressTimer = setTimeout(() => {
                    isLongPress = true;
                    if(confirm(`Wipe category '${cat}'? Notes will move to 'GEN'.`)) {
                        deleteCategory(cat);
                    }
                }, 800); 
            };

            const cancelPress = () => clearTimeout(pressTimer);

            btn.addEventListener('touchstart', startPress, {passive: true});
            btn.addEventListener('touchend', (e) => {
                cancelPress();
                if (!isLongPress) applyFilter(cat); 
            });
            btn.addEventListener('touchmove', cancelPress, {passive: true}); 

            btn.addEventListener('mousedown', startPress);
            btn.addEventListener('mouseup', () => {
                cancelPress();
                if (!isLongPress) applyFilter(cat); 
            });
            btn.addEventListener('mouseleave', cancelPress);

            deckGrid.appendChild(btn);
        });
    }

    function deleteCategory(categoryToDelete) {
        if (categoryToDelete === 'GEN') {
            alert("Cannot delete System 'GEN'.");
            return;
        }
        const notesRaw = localStorage.getItem('infinity_notes_v2');
        if (notesRaw) {
            let notes = JSON.parse(notesRaw);
            notes.forEach(n => { if (n.category === categoryToDelete) n.category = "GEN"; });
            localStorage.setItem('infinity_notes_v2', JSON.stringify(notes));
        }
        savedCategories.delete(categoryToDelete);
        saveCategories();
        if (currentFilter === categoryToDelete) {
            applyFilter(savedCategories.values().next().value || 'GEN');
        } else {
            if (!savedCategories.has(currentFilter)) currentFilter = 'GEN';
            loadAll(); 
        }
    }

    function updateCategorySuggestions() {
        catDataList.innerHTML = '';
        savedCategories.forEach(cat => {
            const option = document.createElement('option');
            option.value = cat;
            catDataList.appendChild(option);
        });
        renderDeck(); 
    }

    function saveCategories() {
        localStorage.setItem('infinity_categories', JSON.stringify([...savedCategories]));
    }

    function loadCategories() {
        const storedCats = localStorage.getItem('infinity_categories');
        if (storedCats) {
            savedCategories = new Set(JSON.parse(storedCats));
        } else {
            savedCategories.add("WORK");
            savedCategories.add("TODO");
            savedCategories.add("IDEA");
        }
        updateCategorySuggestions();
    }

    function applyFilter(category) {
        currentFilter = category;
        renderDeck(); 
        catInput.value = category; 

        const rows = document.querySelectorAll('#notes-list .note-row');
        rows.forEach(row => {
            if (row.dataset.category === category) row.classList.remove('hidden');
            else row.classList.add('hidden');
        });
        setTimeout(() => { notesList.scrollTop = notesList.scrollHeight; }, 10);
    }

    function saveAll() {
        const notes = [];
        document.querySelectorAll('#notes-list .note-row').forEach(row => {
            notes.push({ 
                text: row.querySelector('.note-content').innerText, 
                category: row.dataset.category || "GEN" 
            });
        });
        localStorage.setItem('infinity_notes_v2', JSON.stringify(notes));
    }

    function loadAll() {
        loadCategories();
        const rawData = localStorage.getItem('infinity_notes_v2');
        if (rawData) {
            const notes = JSON.parse(rawData);
            notesList.innerHTML = ''; 
            notes.forEach(note => {
                notesList.appendChild(createNoteRow(note.text, note.category));
                if(note.category) savedCategories.add(note.category);
            });
            saveCategories();
            updateCategorySuggestions();
            if (!currentFilter || !savedCategories.has(currentFilter)) {
                currentFilter = savedCategories.values().next().value || "GEN";
            }
            applyFilter(currentFilter);
        } else {
            currentFilter = savedCategories.values().next().value || "GEN";
            applyFilter(currentFilter);
        }
    }

    function handleEnter(e, sourceElement, type) {
        if (e.key === 'Enter') {
            e.preventDefault();
            const text = sourceElement.innerText.trim();
            if (type === 'main' && text !== "") {
                let category = catInput.value.trim().toUpperCase();
                if (!category) category = "GEN";
                if (!savedCategories.has(category)) {
                    savedCategories.add(category);
                    saveCategories();
                    updateCategorySuggestions();
                    applyFilter(category);
                }
                const newRow = createNoteRow(text, category);
                notesList.appendChild(newRow);
                if (currentFilter !== category) newRow.classList.add('hidden');
                sourceElement.innerText = ""; 
                catInput.value = currentFilter;
                saveAll();
                setTimeout(() => { notesList.scrollTop = notesList.scrollHeight; }, 10);
            } else if (type === 'insert') {
                const insertedRow = createNoteRow("", currentFilter);
                sourceElement.closest('.grid-row').insertAdjacentElement('afterend', insertedRow);
                insertedRow.querySelector('.note-content').focus();
                saveAll();
            }
        }
    }

    catInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') { e.preventDefault(); mainInput.focus(); }});
    mainInput.addEventListener('keydown', (e) => handleEnter(e, mainInput, 'main'));

    function createNoteRow(text, category) {
        const row = document.createElement('div');
        row.className = 'note-row grid-row';
        row.dataset.category = category;
        row.innerHTML = `
            <div class="spacer-line number"></div>
            <div class="content-wrapper">
                <div class="delete-hint">DELETE</div>
                <div class="note-cat-label">${category}</div>
                <div class="note-content" contenteditable="true" spellcheck="false">${text}</div>
                <button class="desktop-delete-btn" tabindex="-1">×</button>
            </div>
        `;
        const content = row.querySelector('.note-content');
        row.querySelector('.desktop-delete-btn').addEventListener('click', () => { row.remove(); saveAll(); });
        content.addEventListener('keyup', saveAll);
        content.addEventListener('keydown', (e) => handleEnter(e, content, 'insert'));

        let startX = 0;
        content.addEventListener('touchstart', (e) => { startX = e.touches[0].clientX; content.style.transition = 'none'; }, { passive: true });
        content.addEventListener('touchmove', (e) => {
            let diff = e.touches[0].clientX - startX;
            if (diff < -20) content.style.transform = `translateX(${diff + 20}px)`;
        }, { passive: true });
        content.addEventListener('touchend', (e) => {
            let finalDiff = e.changedTouches[0].clientX - startX;
            content.style.transition = 'transform 0.4s cubic-bezier(0.1, 0.9, 0.2, 1)';
            if (finalDiff < -180) {
                content.style.transform = 'translateX(-100%)';
                setTimeout(() => { row.remove(); saveAll(); }, 300);
            } else { content.style.transform = 'translateX(0)'; }
        });
        return row;
    }

    document.addEventListener('touchstart', (e) => {
        if (e.target.closest('#category-deck')) return;
        if (!e.target.classList.contains('note-content') && e.target.id !== 'cat-input') {
            e.preventDefault(); mainInput.focus();
        }
    });
    
    window.addEventListener('load', () => { loadAll(); catInput.focus(); });
</script>
</body>
</html>
