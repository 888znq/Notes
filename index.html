<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Infinity Notes</title>
    
    <link rel="manifest" href="manifest.json">

    <meta name="theme-color" content="#000000">
    <meta name="mobile-web-app-capable" content="yes">

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Infinity Notes">
    <link href="https://fonts.googleapis.com/css2?family=Lexend+Deca:wght@900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --phi: 1.618;
            --row-height: 110px; 
            --num-width: 80px; 
            --font-main: 2.1rem;
            --line-weight: 8px;
            --bg-dark: #000000;
            --red: #FF0000;
            --line-style: var(--line-weight) solid var(--red);
            --swipe-delete: #FF0000;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--bg-dark);
            margin: 0;
            padding: 0 0 300px 0; 
            display: flex;
            flex-direction: column;
            height: 100vh;
            font-family: 'Lexend Deca', sans-serif;
            overflow: hidden;
            overscroll-behavior-y: none; 
        }

        .app-frame {
            display: flex;
            flex-direction: column;
            height: 100%;
            width: 100%;
            border-left: var(--line-style);
            border-right: var(--line-style);
            border-bottom: var(--line-style);
            position: relative;
            counter-reset: note-counter;
        }

        #notes-list {
            display: flex;
            flex-direction: column; 
            justify-content: flex-end; 
            width: 100%;
            overflow-y: auto;
            flex-grow: 1;
            -webkit-mask-image: linear-gradient(to top, black 85%, transparent 100%);
            mask-image: linear-gradient(to top, black 85%, transparent 100%);
        }

        .grid-row {
            display: grid;
            grid-template-columns: var(--num-width) 1fr;
            width: 100%;
            height: var(--row-height);
            flex-shrink: 0;
            background-color: var(--bg-dark);
            border-top: var(--line-style);
        }

        .spacer-line {
            height: 100%;
            background-color: var(--bg-dark);
            border-right: var(--line-style);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            color: var(--red);
            font-weight: 900;
        }

        .spacer-line.infinity::after { 
            content: "∞"; 
            font-size: 2.5rem;
            color: var(--red);
        }

        .spacer-line.number::before {
            counter-increment: note-counter;
            content: counter(note-counter) ".";
            font-size: calc(var(--font-main) / 1.4);
            color: var(--red);
        }

        .content-wrapper {
            position: relative;
            overflow: hidden;
            background-color: var(--swipe-delete);
            height: 100%;
        }

        .note-content {
            width: 100%;
            height: 100%;
            background-color: var(--bg-dark);
            color: var(--red);
            border: none;
            padding: 0 25px;
            font-size: var(--font-main);
            font-weight: 900;
            outline: none;
            display: flex;
            align-items: center;
            caret-color: var(--red);
            white-space: nowrap;
            overflow: hidden;
            transition: transform 0.2s ease-out;
            position: relative;
            z-index: 2;
        }

        .delete-hint {
            position: absolute;
            right: 35px;
            top: 0;
            bottom: 0;
            display: flex;
            align-items: center;
            color: black;
            font-size: 1.2rem;
            z-index: 1;
        }

        /* --- NEW DESKTOP DELETE BUTTON STYLES --- */
        .desktop-delete-btn {
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 80px;
            background-color: var(--bg-dark); /* Matches background to look hidden initially */
            color: var(--red);
            border: none;
            font-family: 'Lexend Deca', sans-serif;
            font-size: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 10;
            opacity: 0; /* Hidden by default */
            transition: opacity 0.2s, background-color 0.2s, color 0.2s;
        }

        /* Show button when hovering over the row */
        .content-wrapper:hover .desktop-delete-btn {
            opacity: 1;
        }

        /* Hover effect on the button itself */
        .desktop-delete-btn:hover {
            background-color: var(--red);
            color: var(--bg-dark);
        }
        
        /* Hide this button on touch devices to prevent conflict with swipe */
        @media (hover: none) {
            .desktop-delete-btn { display: none; }
        }

        #notes-list::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

    <div class="app-frame">
        <div id="notes-list"></div>

        <div class="input-area grid-row">
            <div class="spacer-line infinity"></div>
            <div class="content-wrapper">
                <div id="main-input" class="note-content" contenteditable="true" spellcheck="false"></div>
            </div>
        </div>
    </div>

<script>
    const notesList = document.getElementById('notes-list');
    const mainInput = document.getElementById('main-input');

    function saveAll() {
        const notes = [];
        document.querySelectorAll('#notes-list .note-content').forEach(note => {
            notes.push(note.innerText);
        });
        localStorage.setItem('infinity_notes_red_black', JSON.stringify(notes));
    }

    function loadAll() {
        const rawData = localStorage.getItem('infinity_notes_red_black');
        if (rawData) {
            const notes = JSON.parse(rawData);
            notesList.innerHTML = ''; 
            notes.forEach(text => {
                notesList.appendChild(createNoteRow(text));
            });
            notesList.scrollTop = notesList.scrollHeight;
        }
    }

    function handleEnter(e, sourceElement, type) {
        if (e.key === 'Enter') {
            e.preventDefault();
            const text = sourceElement.innerText.trim();
            
            if (type === 'main' && text !== "") {
                notesList.appendChild(createNoteRow(text));
                sourceElement.innerText = "";
                saveAll();
            } else if (type === 'insert') {
                const newNote = createNoteRow("");
                sourceElement.closest('.grid-row').insertAdjacentElement('afterend', newNote);
                newNote.querySelector('.note-content').focus();
                saveAll();
            }
            setTimeout(() => { notesList.scrollTop = notesList.scrollHeight; }, 10);
        }
    }

    mainInput.addEventListener('keydown', (e) => handleEnter(e, mainInput, 'main'));

    function createNoteRow(text) {
        const row = document.createElement('div');
        row.className = 'note-row grid-row';
        
        // Added the delete button inside the HTML structure
        row.innerHTML = `
            <div class="spacer-line number"></div>
            <div class="content-wrapper">
                <div class="delete-hint">DELETE</div>
                <div class="note-content" contenteditable="true" spellcheck="false">${text}</div>
                <button class="desktop-delete-btn" tabindex="-1">×</button>
            </div>
        `;

        const content = row.querySelector('.note-content');
        const deleteBtn = row.querySelector('.desktop-delete-btn');

        // Logic for Desktop Delete Click
        deleteBtn.addEventListener('click', () => {
            row.remove();
            saveAll();
        });

        content.addEventListener('keyup', saveAll);
        content.addEventListener('keydown', (e) => handleEnter(e, content, 'insert'));

        // Touch Swipe Logic (Unchanged)
        let startX = 0;
        content.addEventListener('touchstart', (e) => {
            startX = e.touches[0].clientX;
            content.style.transition = 'none';
        }, { passive: true });

        content.addEventListener('touchmove', (e) => {
            let diff = e.touches[0].clientX - startX;
            if (diff < -20) content.style.transform = `translateX(${diff + 20}px)`;
        }, { passive: true });

        content.addEventListener('touchend', (e) => {
            let finalDiff = e.changedTouches[0].clientX - startX;
            content.style.transition = 'transform 0.4s cubic-bezier(0.1, 0.9, 0.2, 1)';
            if (finalDiff < -180) {
                content.style.transform = 'translateX(-100%)';
                setTimeout(() => {
                    row.remove();
                    saveAll();
                }, 300);
            } else {
                content.style.transform = 'translateX(0)';
            }
        });

        return row;
    }

    document.addEventListener('touchstart', (e) => {
        if (!e.target.classList.contains('note-content')) {
            e.preventDefault();
            mainInput.focus();
        }
    });
    
    window.addEventListener('load', () => {
        loadAll();
        mainInput.focus();
    });
</script>
</body>
</html>